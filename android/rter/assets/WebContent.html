<!DOCTYPE html>
<html>
	<head>
		<meta charset="ISO-8859-1">
		<title>rter webview overlay</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
		<script type="text/javascript">
			
			$(function() {
				init();
			});
			
			var c, ctx;
			function init() {
                c=document.getElementById("overlay");
                c.width=480;
                c.height=360;
                if(0){
				c.width = $(window).width();
				c.height = $(window).height();
				}
				
				console.info("WebContent.html init says that the screen is " + c.width.toString() + " x " + c.height.toString());
				
				ctx=c.getContext("2d");		
				if(0){setInterval(tick, 500);}
			}
			
			function tick() {
				updateCompass(Math.random()*360);
			}
			
			function deg2rad(deg){
                return deg*Math.PI/180;
            }
            
            function clearCanvas(){
				ctx.clearRect(0, 0, c.width, c.height);
				c.width = c.width;
				if(0) {
				if(STX.isAndroid && !STX.is_chrome){
					var w=c.width;
					c.width=1;
					c.width=w;
				}
				}
			}
            
            function drawPoi(_vals) {
				var vals = _vals.split(",");
				if(0) console.info(_vals);
            	if(vals.length != 4) {
            		console.error("wrong number of arguments!");
            	}

            	var bearingToPoi = parseFloat(vals[0]);
            	var distance = parseFloat(vals[1]);
            	var remoteBearing = parseFloat(vals[2]);
            	var color = vals[3];

            	ctx.save();
            	var left = (c.width/2) + (bearingToPoi/60)*c.width;
            	var width = (c.width - (distance*c.width));
            	if(width < 10) {
            		width=10;
            	}
            	var top = c.height*0.3;
            	var height = c.height*0.2;
            	
            	console.info("rect coords: "+left.toString() + " " + top.toString() + " " + width.toString() + " " + height.toString());
            	
            	ctx.fillStyle=color;
				ctx.fillRect(left,top,left+width,top+height);
            	ctx.restore();
            }
            
			function updateCompass(headingStr) {
				heading=parseFloat(headingStr);
				
                var compassSize = 0.15*c.width;

                clearCanvas();
                
                ctx.save();
                ctx.translate(c.width-compassSize, 0);
                if(1){ctx.translate(-0.05*c.width, 0.05*c.height);}
                ctx.translate(compassSize/2, compassSize/2);
                ctx.rotate(deg2rad(-(heading-180)));
                ctx.beginPath();
                ctx.moveTo(0,0);
                ctx.lineTo(0,compassSize/2);
                ctx.strokeStyle = '#88FF00';
                ctx.lineWidth = 3;
                ctx.closePath();
                ctx.stroke();
                ctx.restore();                
            }
            
            function destroyAll() {
            	ctx.clearRect(0,0, c.width, c.height);
            	document.removeChild(c);
            	c=null;
            }
            
    		function sendDataToAndroid(data) {
        		Android.getDataFromJS(data);
    		}
    		
    		function getDataFromAndroid(){
				var data = Android.sendDataToJS();
				document.getElementById("mbutton").value = data;
			}
			
		
		</script>
	</head>
	
	<body>
	<!--
		<input type="button" value="Send Data to Android log" onClick="sendDataToAndroid('Hello Android!')" />
		<br>
		<input type="button" value="Get Data from Android" id="mbutton" onClick="getDataFromAndroid()" />
		
		<br>
	-->
		<canvas id="overlay" width="50" height="50"></canvas>
		
	</body>
</html>